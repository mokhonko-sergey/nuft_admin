<template>
    <div class="md-layout-item md-size-100">
      <actions-tab></actions-tab>
      <nav-tabs-card>
        <template slot="content">
          <span class="md-nav-tabs-title">Users:</span>
          <md-tabs class="md-success" md-alignment="left">

            <md-tab id="tab-home" md-label="Active" md-icon="face">
              <nav-tabs-table 
                :data='activeUsers' 
                @del="deleteUser" 
                @blockUser="blockUser"
                @editUser="editUserData"
              />
            </md-tab>

            <md-tab id="tab-pages" md-label="Blocked" md-icon="block">
              <nav-tabs-table 
                :data='blockedUsers' 
                @del="deleteUser" 
                @blockUser="blockUser"
                @editUser="editUserData"
              />
            </md-tab>

          </md-tabs>
        </template>
      </nav-tabs-card>
      <add-user @updatelistOfUsers="getUsers()"></add-user>
    </div>
</template>

<script>
import NavTabsCard from "./NavTabsCard";
import NavTabsTable from "./NavTabsTable";
import ActionsTab from './ActionsTab';
import AddUser from './AddNewUser';
import FirebaseApi from '@/services/firebase-api';
const { getAllUsers, delUser, udateUserInfo } = new FirebaseApi();
export default {
    components: {
        NavTabsCard,
        NavTabsTable,
        ActionsTab,
        AddUser
    },
    data: () => ({
      users: []
    }),
    computed: {
      activeUsers(){
        return this.users.filter(el => el.disabled === false);
      },
      blockedUsers(){
        return this.users.filter(el => el.disabled === true);
      },
      token(){
        return this.$store.getters.getUser.token;
      }
    },
    methods: {
      async getUsers(){
        const result = await getAllUsers(this.token);
        this.users = result;
      },

      async deleteUser(id){   
        const result = await delUser(id, this.token);
        if(result.success){
          this.notifyVue(result.message, 'done', 'success');
          this.getUsers();
          return;
        }
        this.notifyVue(result.message, 'warning', 'danger');
      },

      async blockUser(data){
        const newUserData = {
          uid: data.uid,
          email: data.email,
          disabled: !data.disabled
        };

        try{
          const result = await udateUserInfo(this.token, newUserData);
          if(result.success){
            this.notifyVue(result.message, 'done', 'success');
            this.getUsers();
            return;
          }
          this.notifyVue(result.message, 'warning', 'danger');
        }catch(err){
          console.log(err);
        }

      },

      editUserData(data){
        console.log("Edit", data)
      },

      notifyVue(message, icon, type, verticalAlign='top', horizontalAlign='right') {
        this.$notify({ message, icon, horizontalAlign, verticalAlign, type });
      }
    },
    created(){
      this.getUsers();
    }
}
</script>